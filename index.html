<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#3b82f6" />
    <meta name="description" content="의정부시 재난담당실 전용 실시간 날씨 정보 대시보드" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="의정부 날씨" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- iOS 아이콘 -->
    <link rel="apple-touch-icon" href="/icon-192.png" />

    <title>의정부시 재난대응 날씨 대시보드</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Service Worker 등록 (선택적 기능) -->
    <script>
      // Service Worker는 선택적 PWA 기능 - 실패해도 앱은 정상 작동
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // Service Worker 등록을 비동기로 처리하여 앱 로딩 차단 방지
          setTimeout(() => {
            navigator.serviceWorker.register('/service-worker.js')
              .then((registration) => {
                console.log('✅ Service Worker 등록 성공:', registration.scope);
              })
              .catch((error) => {
                // Service Worker 등록 실패는 치명적이지 않음
                console.warn('⚠️ Service Worker 등록 실패 (앱은 정상 작동):', error);
              });
          }, 1000); // 1초 후에 등록하여 초기 렌더링 방해하지 않음
        });
      } else {
        console.log('ℹ️ Service Worker not supported - app will work normally without PWA features');
      }

      // 디버깅: root 엘리먼트 확인
      window.addEventListener('DOMContentLoaded', () => {
        const root = document.getElementById('root');
        if (!root) {
          console.error('Root element not found!');
        } else {
          console.log('Root element found, app should load...');
        }
      });

      // 전역 오류 핸들러
      window.onerror = function(message, source, lineno, colno, error) {
        console.error('Global error caught:', {
          message, source, lineno, colno, error
        });

        // root에 React 앱이 마운트되지 않았을 때만 오류 UI 표시
        const root = document.getElementById('root');
        if (root && (!root.innerHTML || root.innerHTML.trim() === '')) {
          root.innerHTML = `
            <div style="max-width: 800px; margin: 50px auto; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
              <div style="background: #fee; border-left: 4px solid #c00; padding: 20px; border-radius: 4px;">
                <h1 style="color: #c00; margin: 0 0 15px 0;">⚠️ 앱 로딩 오류</h1>
                <p style="margin: 10px 0;">JavaScript 오류가 발생했습니다:</p>
                <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 13px;">
${message}
at ${source}:${lineno}:${colno}
                </pre>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                  <p style="margin: 10px 0;"><strong>문제 해결 방법:</strong></p>
                  <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>브라우저를 새로고침 해보세요 (Ctrl+F5 또는 Cmd+Shift+R)</li>
                    <li>브라우저 캐시를 삭제해보세요</li>
                    <li>다른 브라우저로 시도해보세요</li>
                  </ul>
                  <p style="margin: 15px 0 5px 0; font-size: 12px; color: #666;">
                    자세한 정보는 브라우저 콘솔(F12)에서 확인하세요.
                  </p>
                </div>
              </div>
            </div>
          `;
        }

        return false;
      };

      // Unhandled Promise Rejection 핸들러
      window.onunhandledrejection = function(event) {
        console.error('Unhandled promise rejection:', event.reason);
        return false;
      };
    </script>
  </body>
</html>